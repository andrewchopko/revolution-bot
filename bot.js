const express = require('express');
const Telegraf = require("telegraf");
const app = new Telegraf("430018492:AAHiWOE74uDCBFQyqqnruUTSxeBs16qE0Zw");
const exp = express();

var counter = {
	bot_pidor: 0,
	task_web: 0,
	task_mobile_app: 0,
	task_mobile_game: 0,
	time: 0,
	call_org: 0,
	games: 0
}

let resps = [ "Ğ¯Ğ½Ğ° (HR) t.me/yanahata",  
			  "Ğ•Ğ½Ğ´Ñ€Ñ (Task Responsible) t.me/Andrewchopko",
			  "Ğ”ĞµĞ½Ğ¸Ñ (Main Organizer) t.me/den_honcharuk",
			  "ĞĞ»ĞµĞ½Ğ° (Organizer) t.me/goodfiddler",
			  "ĞĞºÑĞ°Ğ½Ğ° (Organizer) t.me/coffee_drinker",
			  "Ğ”ĞµĞ¼'ÑĞ½ (Organizer) t.me/sdsvin" ];


var game_responses = ["Ğ¼Ğ¾Ğ¶Ğ»Ğ¸Ğ²Ğ¾ Ğ²Ğ°Ñ€Ñ‚Ğ¾ Ğ¿Ğ¾ĞºĞ¾Ğ´Ğ¸Ñ‚Ğ¸?", "ĞºÑ€Ğ°Ñ‰Ğµ Ğ²Ğ¸Ğ¿Ğ¸Ğ¹ ĞºĞ°Ğ²Ğ¸.", "Ğ·'Ñ—Ğ¶ Ğ¿ĞµÑ‡Ğ¸Ğ²ĞºĞ¾!", "Ğ¿Ğ¾Ğ´ÑƒĞ¼Ğ°Ğ¹ ĞºÑ€Ğ°Ñ‰Ğµ, Ñ‡Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ñ– Ñ‚Ğ¾Ğ±Ñ– Ñ–Ğ³Ñ€Ğ¸ Ğ·Ğ°Ñ€Ğ°Ğ·?", "Ğ´Ğ»Ñ Ñ‡Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ±Ñ– Ñ†Ğµ, ÑĞºĞ°Ğ¶Ğ¸ Ğ¾Ñ€Ğ³Ğ°Ğ½Ñ–Ğ·Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼ Ñ‡Ğ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ°Ñ”Ñ‚ÑŒÑÑ Ñ‚Ğ¾Ğ±Ñ– Ñ…Ğ°ĞºĞ°Ñ‚Ğ¾Ğ½ :)"];


app.hears('hi', ctx => {
	return ctx.reply("Hey!");
	counter.hi++;
	console.log(counter.hi);
});

app.command('bot_pidor@it_revolution17_bot', ctx => {
	counter.bot_pidor++;
	return ctx.replyWithMarkdown(ctx.message.from.username + " pidor!");
});

app.command('task_web@it_revolution17_bot', ctx => {
	counter.task_web++;
	return ctx.replyWithMarkdown("Ğ£ ÑÑƒÑ‡Ğ°ÑĞ½Ğ¾Ğ¼Ñƒ ÑĞ²Ñ–Ñ‚Ñ– Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¾Ñ‡ÑƒÑ” Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ·Ğ½Ğ° ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ—. ĞšĞ¾Ğ¶ĞµĞ½ Ğ´ĞµĞ½ÑŒ, ĞºĞ¾Ğ»Ğ¸ Ğ¼Ğ¸ Ğ½Ğ°Ğ¼Ğ°Ğ³Ğ°Ñ”Ğ¼Ğ¾ÑÑ Ğ·Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ñ‰Ğ¾ÑÑŒ Ñ†Ñ–ĞºĞ°Ğ²Ğµ Ñ– Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğµ, Ğ½Ğ°Ğ¼ Ğ´Ğ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚ÑŒÑÑ Ğ²Ğ¸Ñ‚Ñ€Ğ°Ñ‡Ğ°Ñ‚Ğ¸ Ğ±Ğ°Ğ³Ğ°Ñ‚Ğ¾ Ñ‡Ğ°ÑÑƒ Ğ½Ğ° Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ñƒ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ±Ñ–Ñ€ĞºĞ¸ Ñ‚Ğ¾Ğ³Ğ¾, Ñ‰Ğ¾ Ñ†Ñ–ĞºĞ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ñ. Ğ£ Ğ±Ğ°Ğ³Ğ°Ñ‚ÑŒĞ¾Ñ… ÑÑ„ĞµÑ€Ğ°Ñ… (ĞºÑ–Ğ½Ğ¾, Ğ¼ÑƒĞ·Ğ¸ĞºĞ°, ÑĞ¿Ğ¾Ñ€Ñ‚ ...) Ñ†Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ²Ğ¸Ñ€Ñ–ÑˆĞ¸Ñ‚Ğ¸ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑÑ‡Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ñ–Ğ². Ğ¢Ğ°ĞºĞ¸Ğ¼ Ñ‡Ğ¸Ğ½Ğ¾Ğ¼ Ğ’Ğ°ÑˆĞµ Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ Ğ¿Ğ¾Ğ»ÑĞ³Ğ°Ñ” Ğ² Ğ¿Ğ¾Ğ±ÑƒĞ´Ğ¾Ğ²Ñ– Ğ´Ğ¾Ğ´Ğ°Ñ‚ĞºÑƒ Ğ· Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ñ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ”Ñ Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ¾Ñ— Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ½Ğ¾Ñ— Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ñ–, Ğ² ÑĞºĞ¾Ğ¼Ñƒ Ñ” ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ñƒ (Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ Ğ¼Ğ¾Ğ¶Ğµ ÑĞºĞ»Ğ°Ğ´Ğ°Ñ‚Ğ¸ÑÑ Ğ²ÑÑ–Ğ¼Ğ° ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°Ğ¼Ğ¸ Ğ²Ğ°ÑˆĞ¾Ğ³Ğ¾ Ñ€ĞµÑÑƒÑ€ÑÑƒ Ğ°Ğ±Ğ¾ Ğ¶ ÑĞ¿ĞµÑ†Ñ–Ğ°Ğ»ÑŒĞ½Ğ¾Ñ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ”Ñ, ÑĞºĞ° Ñ„Ğ¾Ñ€Ğ¼ÑƒÑ”Ñ‚ÑŒÑÑ Ğ°Ğ´Ğ¼Ñ–Ğ½Ğ¾Ğ¼). ĞÑĞ½Ğ¾Ğ²Ğ½Ğ° Ğ¼ĞµÑ‚Ğ° - ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ğ¿Ğ¾Ğ²Ğ¸Ğ½ĞµĞ½ ÑĞºĞ¾Ğ¼Ğ¾Ğ³Ğ° ÑˆĞ²Ğ¸Ğ´ÑˆĞµ Ğ·Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñƒ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ.");
});

app.command('task_mobile_app@it_revolution17_bot', ctx => {
	counter.task_mobile_app++;
	return ctx.replyWithMarkdown("Ğ£ ÑÑƒÑ‡Ğ°ÑĞ½Ğ¾Ğ¼Ñƒ ÑĞ²Ñ–Ñ‚Ñ– Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¾Ñ‡ÑƒÑ” Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ·Ğ½Ğ° ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ—. ĞšĞ¾Ğ¶ĞµĞ½ Ğ´ĞµĞ½ÑŒ, ĞºĞ¾Ğ»Ğ¸ Ğ¼Ğ¸ Ğ½Ğ°Ğ¼Ğ°Ğ³Ğ°Ñ”Ğ¼Ğ¾ÑÑ Ğ·Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ñ‰Ğ¾ÑÑŒ Ñ†Ñ–ĞºĞ°Ğ²Ğµ Ñ– Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğµ, Ğ½Ğ°Ğ¼ Ğ´Ğ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚ÑŒÑÑ Ğ²Ğ¸Ñ‚Ñ€Ğ°Ñ‡Ğ°Ñ‚Ğ¸ Ğ±Ğ°Ğ³Ğ°Ñ‚Ğ¾ Ñ‡Ğ°ÑÑƒ Ğ½Ğ° Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ñƒ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ±Ñ–Ñ€ĞºĞ¸ Ñ‚Ğ¾Ğ³Ğ¾, Ñ‰Ğ¾ Ñ†Ñ–ĞºĞ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ñ. Ğ£ Ğ±Ğ°Ğ³Ğ°Ñ‚ÑŒĞ¾Ñ… ÑÑ„ĞµÑ€Ğ°Ñ… (ĞºÑ–Ğ½Ğ¾, Ğ¼ÑƒĞ·Ğ¸ĞºĞ°, ÑĞ¿Ğ¾Ñ€Ñ‚ ...) Ñ†Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ²Ğ¸Ñ€Ñ–ÑˆĞ¸Ñ‚Ğ¸ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑÑ‡Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ñ–Ğ². Ğ¢Ğ°ĞºĞ¸Ğ¼ Ñ‡Ğ¸Ğ½Ğ¾Ğ¼ Ğ’Ğ°ÑˆĞµ Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ Ğ¿Ğ¾Ğ»ÑĞ³Ğ°Ñ” Ğ² Ğ¿Ğ¾Ğ±ÑƒĞ´Ğ¾Ğ²Ñ– Ğ´Ğ¾Ğ´Ğ°Ñ‚ĞºÑƒ Ğ· Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ñ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ”Ñ Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ¾Ñ— Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ½Ğ¾Ñ— Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ñ–, Ğ² ÑĞºĞ¾Ğ¼Ñƒ Ñ” ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ñƒ (Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ Ğ¼Ğ¾Ğ¶Ğµ ÑĞºĞ»Ğ°Ğ´Ğ°Ñ‚Ğ¸ÑÑ Ğ²ÑÑ–Ğ¼Ğ° ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°Ğ¼Ğ¸ Ğ²Ğ°ÑˆĞ¾Ğ³Ğ¾ Ñ€ĞµÑÑƒÑ€ÑÑƒ Ğ°Ğ±Ğ¾ Ğ¶ ÑĞ¿ĞµÑ†Ñ–Ğ°Ğ»ÑŒĞ½Ğ¾Ñ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ”Ñ, ÑĞºĞ° Ñ„Ğ¾Ñ€Ğ¼ÑƒÑ”Ñ‚ÑŒÑÑ Ğ°Ğ´Ğ¼Ñ–Ğ½Ğ¾Ğ¼). ĞÑĞ½Ğ¾Ğ²Ğ½Ğ° Ğ¼ĞµÑ‚Ğ° - ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ğ¿Ğ¾Ğ²Ğ¸Ğ½ĞµĞ½ ÑĞºĞ¾Ğ¼Ğ¾Ğ³Ğ° ÑˆĞ²Ğ¸Ğ´ÑˆĞµ Ğ·Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñƒ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ.");
});

app.command('task_mobile_game@it_revolution17_bot', ctx => {
	counter.task_mobile_game++;
	return ctx.replyWithMarkdown("ĞÑÑ‚Ğ°Ğ½Ğ½Ñ–Ğ¼Ğ¸ Ñ€Ğ¾ĞºĞ°Ğ¼Ğ¸ Ğ²ÑĞµ Ğ±Ñ–Ğ»ÑŒÑˆĞ¾Ñ— Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ğ¾ÑÑ‚Ñ– Ğ½Ğ°Ğ±ÑƒĞ²Ğ°Ñ” AR/VR. ĞŸÑ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ½ÑĞ¼ Ñ‚Ğ¾Ğ¼Ñƒ Ñ” Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ĞºĞ° Ñ‚Ğ° ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ ÑĞ²Ğ¾Ğ³Ğ¾ ARKit ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ñ–Ñ”Ñ Apple Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ñ–Ğ· Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ñ–Ñ… Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ñ—Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ğ¹Ğ½Ğ¸Ñ… ÑĞ¸ÑÑ‚ĞµĞ¼. ĞĞ»Ğµ Ğ²ÑÑ– Ğ·Ğ²Ğ¸ĞºĞ»Ğ¸, Ñ‰Ğ¾ Ğ¿Ñ€Ğ¸ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ– Ñ†Ğ¸Ñ… Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ğ¹ AR/VR Ğ·Ğ°Ğ¹Ğ¼Ğ°Ñ” ĞºĞ»ÑÑ‡Ğ¾Ğ²Ñƒ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ñ–Ñ Ğ² Ğ´Ğ¾Ğ´Ğ°Ñ‚ĞºÑƒ (Ñ‡Ğ¸ Ğ³Ñ€Ñ–). ĞÑ‚Ğ¾Ğ¶, Ğ²Ğ°ÑˆĞµ Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ Ñ€Ğ¾Ğ·Ñ€Ğ¾Ğ±Ğ¸Ñ‚Ğ¸ Ğ³Ñ€Ñƒ, Ğ² ÑĞºÑ–Ğ¹ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ AR Ğ² Ğ½ĞµÑ‚Ñ€Ğ¸Ğ²Ñ–Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ğ´Ğ»Ñ ÑĞµĞ±Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ñ–Ğ¾Ğ½ÑƒĞ²Ğ°Ğ½Ğ½Ñ–. ĞŸÑ€Ğ¾ÑĞ²Ğ»ÑĞ¹Ñ‚Ğµ ĞºÑ€ĞµĞ°Ñ‚Ğ¸Ğ²Ğ½Ñ–ÑÑ‚ÑŒ Ñ‚Ğ° Ñ„Ğ°Ğ½Ñ‚Ğ°Ğ·Ñ–Ñ. ĞŸÑ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ñ€ĞµĞ°Ğ»Ñ–Ğ·ÑƒĞ²Ğ°Ñ‚Ğ¸ ÑĞ²Ğ¾Ñ— ÑĞ°Ğ¼Ñ– Ğ±Ğ¾Ğ¶ĞµĞ²Ñ–Ğ»ÑŒĞ½Ñ– Ñ–Ğ´ĞµÑ—.");
});

app.command('games@it_revolution17_bot', ctx => {
	counter.games++;
	var response = game_responses[Math.floor(Math.random()*game_responses.length)];
	return ctx.reply(ctx.message.from.username + " " + response);
});

app.command('tic_tic_tic', ctx => {
	return ctx.reply(counter);
});

app.command('time@it_revolution17_bot', ctx => {

	let time = Date.now();
	let target_time = new Date(2017, 10, 19, 12, 0);
	counter.time++;

	if (time > target_time){
		return ctx.replyWithMarkdown("Ğ§Ğ°Ñ Ğ²Ğ¸Ñ‡ĞµÑ€Ğ¿Ğ°Ğ½Ğ¾, Ğ³Ğ¾Ñ‚ÑƒĞ¹Ñ‚ĞµÑÑŒ Ğ´Ğ¾ Ğ¿Ñ€ĞµĞ·ĞµĞ½Ñ‚Ğ°Ñ†Ñ–Ñ— :)");	
	} else {
		let time_in_mils = target_time - time;

		return ctx.replyWithMarkdown(msToTime(time_in_mils));
	}
	
});

app.command('call_org@it_revolution17_bot', ctx => {
	counter.call_org++;
	resps.forEach(function(element){
		return ctx.reply(element);
	});
});

app.on('sticker', (ctx) => ctx.reply('ğŸ‘'))

function msToTime(duration) {
        var milliseconds = parseInt((duration%1000)/100)
            , seconds = parseInt((duration/1000)%60)
            , minutes = parseInt((duration/(1000*60))%60)
            , hours = parseInt((duration/(1000*60*60))%24)
            , days = parseInt((duration/(1000*60*60*24)));

        days = (days < 10) ? "0" + days : days;
        hours = (hours < 10) ? "0" + hours : hours;
        minutes = (minutes < 10) ? "0" + minutes : minutes;
        seconds = (seconds < 10) ? "0" + seconds : seconds;

        return days + " Ğ´Ğ½Ñ–Ğ² " + hours + " Ğ³Ğ¾Ğ´Ğ¸Ğ½ " + minutes + " Ñ…Ğ²Ğ¸Ğ»Ğ¸Ğ½ " + seconds + " ÑĞµĞºÑƒĞ½Ğ´ Ğ´Ğ¾ ĞºÑ–Ğ½Ñ†Ñ Ñ…Ğ°ĞºĞ°Ñ‚Ğ¾Ğ½Ñƒ";
}

exp.get('/', (req, res) => res.send('Hello World!'));

app.startPolling();
exp.listen(process.env.PORT || 5000, () => console.log("Server on 3000!"));